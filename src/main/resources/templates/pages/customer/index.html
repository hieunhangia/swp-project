<div layout:decorate="~{layouts/customer-layout}"
     xmlns:th="http://www.thymeleaf.org"
     xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

  <div layout:fragment="content">

    <h1>Welcome to the Customer Homepage</h1>

    <a th:if="${!#authorization.expression('isAuthenticated()')}" th:href="@{/login}">Đăng nhập</a>
    <a th:if="${#authorization.expression('isAuthenticated()')}" th:href="@{/customer/account-manager}">Quản lí tài khoản</a>
    <a th:href="@{/ai}">AI chatbot</a>
    <a th:if="${#authorization.expression('isAuthenticated()')}" th:href="@{/customer/shopping-cart}">Giỏ hàng</a>
    <a th:href="@{/customer/homepage}">Trang chủ</a>

    <!-- Search Form -->
    <form method="get" action="/customer/homepage" class="mb-3">
        <div class="input-group">
            <input type="text" name="keyword" class="form-control" placeholder="Search products..."
                   th:value="${keyword}" aria-label="Search products">
            <button class="btn btn-primary" type="submit">Search</button>
        </div>
    </form>

    <!-- Category Dropdown -->
    <form method="get" action="/customer/homepage">
        <label for="category">Filter by Category:</label>
        <input type="hidden" name="keyword" th:value="${keyword}" /> <!-- Preserve the search keyword -->
        <select name="categoryId" id="category" class="form-select" onchange="this.form.submit()">
            <option value="0" th:text="'All Categories'" th:selected="${categoryId == 0}"></option>
            <option th:each="category : ${categories}"
                    th:value="${category.id}"
                    th:text="${category.name}"
                    th:selected="${category.id == categoryId}">
            </option>
        </select>
    </form>

    <!-- Products Table -->
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Product ID</th>
                <th>Image</th>
                <th>Name</th>
                <th>Price</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="product : ${viewProductDto}">
                <td th:text="${product.id}"></td>
                <td><img th:src="${product.mainImageUrl}" alt="Product Image" style="width: 100px; height: auto;"></td>
                <td th:text="${product.name}"></td>
                <td th:text="${product.price}"></td>
            </tr>
        </tbody>
    </table>

    <!-- Pagination Controls -->
    <div class="d-flex justify-content-between">
        <a th:href="@{/customer/homepage(page=${viewProductDto.number - 1}, size=${viewProductDto.size}, categoryId=${categoryId})}"
           th:if="${!viewProductDto.first}" class="btn btn-primary">Previous</a>
        <a th:href="@{/customer/homepage(page=${viewProductDto.number + 1}, size=${viewProductDto.size}, categoryId=${categoryId})}"
           th:if="${!viewProductDto.last}" class="btn btn-primary">Next</a>
    </div>

  </div>
</div>
