<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chi ti·∫øt ƒë∆°n h√†ng</title>
  <link rel="stylesheet" href="/css/bootstrap/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body class="auth-body">
<a th:href="${returnUrl != null} ? ${returnUrl} : '/shipper'" class="btn btn-light position-absolute top-0 start-0 m-3">‚Üê Quay l·∫°i</a>
<div class="container py-5">
  <div class="auth-card p-4 shadow-sm">
    <div th:object="${order}">
      <h1 class="h4 mb-4 text-primary">üßæ Chi ti·∫øt ƒë∆°n h√†ng</h1>

      <p><strong>M√£ ƒë∆°n h√†ng:</strong> <span th:text="*{id}"></span></p>
      <p><strong>T√™n kh√°ch h√†ng:</strong> <span th:text="*{fullName}"></span></p>
      <p><strong>ƒê·ªãa ch·ªâ giao h√†ng:</strong> <span th:text="*{addressString}"></span></p>
      <p><strong>Ng√†y giao h√†ng:</strong> <span th:text="${shippedAt}"></span></p>

      <div th:if="${orderStatusService.isShippingStatus(order) || orderStatusService.isDeliveredStatus(order)}" class="card mb-4">
        <div class="card-header bg-light fw-semibold">Tr·∫°ng th√°i v·∫≠n chuy·ªÉn</div>
          <div class="card-body">
              <div class="shipping-timeline">
                  <div th:each="shipping, iterStat : ${order.shipping}"
                      class="timeline-item d-flex gap-3 pb-3"
                      th:classappend="${!iterStat.last} ? 'mb-3 border-bottom' : ''">
                      <div class="timeline-marker">
                          <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center"
                              style="width: 40px; height: 40px; min-width: 40px;">
                              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                  class="bi bi-check-circle-fill" viewBox="0 0 16 16">
                                  <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                              </svg>
                          </div>
                      </div>
                      <div class="timeline-content flex-grow-1 align-content-center">
                          <div class="d-flex justify-content-between">
                              <h6 class="mb-0 fw-semibold text-primary" style="padding: 0"
                                  th:text="${shipping.shippingStatus.description}"></h6>
                              <span class="badge bg-light text-muted border" style="font-size: 15px"
                                    th:text="${'C·∫≠p nh·∫≠t l√∫c ' + #temporals.format(shipping.occurredAt, 'dd/MM/yyyy HH:mm')}"></span>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      <h2 class="h5 mt-4">üì¶ Th√¥ng tin s·∫£n ph·∫©m</h2>
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>STT</th>
              <th>S·∫£n ph·∫©m</th>
              <th>ƒê∆°n gi√°</th>
              <th>S·ªë l∆∞·ª£ng</th>
              <th>Th√†nh ti·ªÅn</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="item, iterStat : *{orderItem}">
              <td th:text="${iterStat.index + 1}"></td>
              <td>
                <div class="d-flex align-items-center">
                  <img th:src="@{${item.product.main_image_url}}" alt="" class="me-2" style="width: 50px; height: 50px; object-fit: cover;">
                  <span th:text="${item.product.name}"></span>
                </div>
              </td>
              <td th:text="${#numbers.formatInteger(item.product.price, 0, 'POINT')} + 'ƒë / ' + ${item.product.unit.name}"></td>
              <td th:text="${#numbers.formatInteger(item.quantity, 0, 'POINT')}"></td>
              <td th:text="${#numbers.formatInteger(item.product.price * item.quantity, 0, 'POINT')} + 'ƒë'"></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- T·ªïng ti·ªÅn -->
      <div class="text-end mt-3">
        <h4 class="text-danger">
          T·ªïng c·ªông: <span th:text="${#numbers.formatInteger(totalAmount, 0, 'POINT')}"></span>ƒë
        </h4>
      </div>
      <!-- Button to mark as picked up -->
      <form th:action="@{/shipper/mark/{id}(id=${order.id})}" method="post" th:if="${shippingStatusService.isAwaitingPickupStatus(order.currentShippingStatus)}">
        <button type="submit" class="btn btn-success btn-sm">ƒê√£ l·∫•y h√†ng</button>
      </form>
      <!-- Button to mark as shipping -->
      <form th:action="@{/shipper/mark/{id}(id=${order.id})}" method="post" th:if="${shippingStatusService.isPickedUpStatus(order.currentShippingStatus)}">
        <button type="submit" class="btn btn-success btn-sm">ƒêang giao h√†ng</button>
      </form>
      <!-- Button to mark as delivered -->
      <form th:action="@{/shipper/mark/{id}(id=${order.id})}" method="post" th:if="${shippingStatusService.isShippingStatus(order.currentShippingStatus)}">
        <button type="submit" class="btn btn-success btn-sm">Ho√†n th√†nh</button>
      </form>
    </div>
  </div>
</div>
<script src="/js/bootstrap/bootstrap.bundle.min.js"></script>
</body>
</html>
