<div layout:decorate="~{layouts/customer-layout}" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

    <div layout:fragment="content">

        <h1>Kết quả tìm kiếm</h1>
        <h2>Có <span th:text="${totalElement}"></span> sản phẩm phù hợp</h2>



        <!-- Category Dropdown -->
        <form method="get" th:action="@{${url}}">
            <label for="category">Lọc theo danh mục:</label>
            <input type="hidden" name="keyword" th:value="${keyword}" /> <!-- Preserve the search keyword -->
            <select name="categoryId" id="category" class="form-select form-select-sm" style="width: auto;"
                onchange="this.form.submit()">
                <option value="0" th:text="'Tất cả danh mục'" th:selected="${categoryId == 0}"></option>
                <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}"
                    th:selected="${category.id == categoryId}">
                </option>
            </select>
        </form>

        <div class="mb-3 d-flex align-items-center">
            <label for="sortOption" class="form-label me-2">Sắp xếp theo:</label>
            <form method="get" th:action="@{${url}}" class="d-flex">
                <input type="hidden" name="categoryId" th:value="${categoryId}" /> <!-- Preserve the category -->
                <select name="sortBy" id="sortOption" class="form-select form-select-sm me-2" style="width: auto;"
                    onchange="this.form.submit()">
                    <option value="default" th:selected="${sortBy == null or sortBy == 'default'}">Mặc định</option>
                    <option value="price-asc" th:selected="${sortBy == 'price-asc'}">Giá: Thấp đến cao</option>
                    <option value="price-desc" th:selected="${sortBy == 'price-desc'}">Giá: Cao đến thấp</option>
                    <option value="name-asc" th:selected="${sortBy == 'name-asc'}">Tên: A-Z</option>
                    <option value="name-desc" th:selected="${sortBy == 'name-desc'}">Tên: Z-A</option>
                    <option value="newest" th:selected="${sortBy == 'newest'}">Mới nhất</option>
                    <option value="oldest" th:selected="${sortBy == 'oldest'}">Cũ nhất</option>
                    <option value="best-seller" th:selected="${sortBy == 'best-seller'}">Bán chạy nhất</option>
                </select>
            </form>
        </div>

        <!-- Products Table -->
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID Sản Phẩm</th>
                    <th>Ảnh</th>
                    <th>Tên sản phẩm</th>
                    <th>Giá</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="product : ${viewProductDto}">
                    <td th:text="${product.id}"></td>
                    <td><img th:src="${product.main_image_url}" alt="Product Image" style="width: 100px; height: auto;">
                    </td>
                    <td>
                        <a th:href="@{/product/{id}(id=${product.id})}" th:text="${product.name}"></a>
                    </td>
                    <td th:text="${product.price}"></td>
                </tr>
            </tbody>
        </table>
            <a th:href="@{${url}(page=${viewProductDto.number - 1}, size=${viewProductDto.size}, categoryId=${categoryId}, keyword=${keyword})}"
                th:if="${!viewProductDto.first}" class="btn btn-primary">Trước</a>
            <a th:href="@{${url}(page=${viewProductDto.number + 1}, size=${viewProductDto.size}, categoryId=${categoryId}, keyword=${keyword})}"
                th:if="${!viewProductDto.last}" class="btn btn-primary">Tiếp theo</a>
        </div>
    </div>
</div>