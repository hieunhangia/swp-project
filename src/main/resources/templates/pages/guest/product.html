<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Thông tin đơn hàng</title>
    <link rel="stylesheet" href="/css/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
        <div class="alerts-stack" style="height: 0; width: fit-content; margin: 0 50px 0 auto;">
            <div class="alert alert-success alert-dismissible fade show" th:hidden="${msg == null}">
                <strong>Thành công!</strong> <span th:text="${msg}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            <div class="alert alert-danger alert-dismissible fade show" th:hidden="${error == null}">
                <strong>Thất bại!</strong> <span th:text="${error}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        </div>

        <div class="container py-5">

            <div class="auth-card p-4 mx-auto shadow">
                <div class="row g-4">
                    <!-- Hình ảnh chính -->
                    <div class="col-lg-6 product-main text-center">
                        <img th:src="${product.main_image_url}" alt="Sản phẩm" style="width: 100%;">
                        <div class="product-thumbnails mt-3 d-flex justify-content-center gap-2 flex-wrap">
                            <img th:each="subImage : ${subImages}"
                                 th:src="${subImage.sub_image_url}"
                                 alt="Ảnh phụ"
                                 style="width: 30%;">
                        </div>
                    </div>

                    <!-- Thông tin sản phẩm -->
                    <div class="col-lg-6">
                        <h1 class="h4 mb-3 text-primary fw-bold" th:text="${product.name}"></h1>

                        <div class="mb-3">
                            <div class="btn btn-light" th:each="category : ${categories}">
                                <a th:href="@{'/?categoryId=' + ${category.id}}" th:text="${category.name}" style="text-decoration: none; "></a>
                            </div>
                        </div>

                        <h2 class="h5 text-danger mb-3" th:text="${#numbers.formatInteger(product.price, 0, 'POINT')} + ' đ'"></h2>
                        <p th:text="${'Đã bán '} + ${soldQuantity} + ', Còn ' + ${maxQuantity}" style="color: blue"></p>
                        <p class="mb-4 text-muted" th:text="${product.description}"></p>
                        <p class="mb-4 text-primary" th:text="'Trong giỏ hàng: ' + ${quantityInCart} + ' ' + ${product.unit.name}" th:if="${quantityInCart > 0}"></p>
                        
                        <form th:action="@{/product/add}" method="post" class="d-flex flex-column flex-sm-row align-items-sm-end gap-3">
                            <input type="hidden" name="productId" th:value="${product.id}">
                            <div>
                                <label for="quantity" class="form-label" th:text="'Số lượng' + ' (' + ${product.unit.name} + ')'"></label>
                                <input id="quantity" type="number" name="quantity" value="1" min="1" th:max="${maxQuantity}" class="form-control w-auto" th:if="${product.unit.isAllowDecimal == false}">
                                <input id="quantity" type="number" name="quantity" value="1" step="0.1" min="0.1" th:max="${maxQuantity}" class="form-control w-auto" th:if="${product.unit.isAllowDecimal == true}">
                            </div>
                            <button type="submit" class="btn btn-primary btn-lg shadow-sm" th:if="${maxQuantity > 0}">Thêm vào giỏ hàng</button>
                            <button type="button" class="btn btn-secondary btn-lg shadow-sm" th:if="${maxQuantity == 0}" disabled>Hết hàng</button>
                        </form>
                    </div>

                    <div class="related-products mt-5">
                        <h3 class="h5 mb-4 text-secondary fw-bold">Sản phẩm liên quan</h3>
                        <div class="row g-4">
                            <div class="col-md-4" th:each="relatedProduct : ${relatedProducts}">
                                <a class="card product-card h-100" th:href="@{/product/{id}(id=${relatedProduct.id})}" style="text-decoration: none;">
                                    <div class="product-image">
                                        <img th:src="${relatedProduct.main_image_url}" class="card-img-top" alt="Sản phẩm liên quan">
                                    </div>
                                    <div class="card-body d-flex flex-column product-info">
                                        <h5 style="font-weight: bold;" th:text="${relatedProduct.name}">Product Name</h5>
                                        <p class="card-text text-danger fw-bold" th:text="${#numbers.formatInteger(relatedProduct.price, 0, 'POINT')} + ' đ'"></p>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <div th:replace="~{fragments/footer :: footer}"></div>
    <script th:src="@{/js/bootstrap/bootstrap.bundle.min.js}"></script>
</body>