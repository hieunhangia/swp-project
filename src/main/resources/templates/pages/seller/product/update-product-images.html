<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Cập nhật hình ảnh sản phẩm</title>
    <link rel="stylesheet" href="/css/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            padding: 20px;
        }

        .current-images {
            margin-bottom: 30px;
        }

        .image-container {
            position: relative;
            display: inline-block;
            margin: 10px;
            border: 3px solid #dee2e6;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .image-container:hover {
            border-color: #007bff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .image-container img {
            width: 200px;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .image-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            color: white;
            text-align: center;
            padding: 10px 5px 5px;
            font-size: 12px;
            font-weight: bold;
        }

        .main-image-label {
            background: linear-gradient(transparent, rgba(220, 53, 69, 0.8));
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            display: block;
        }

        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }

        .file-label {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 150px;
            border: 2px dashed #ced4da;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #fff;
            color: #6c757d;
            font-size: 14px;
            text-align: center;
            padding: 15px 10px;
        }

        .file-label:hover {
            border-color: #007bff;
            background-color: #f8f9ff;
            color: #007bff;
        }

        .file-label.has-file {
            border-color: #28a745;
            background-color: #f8fff9;
            color: #28a745;
        }

        .preview-container {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .preview-item {
            position: relative;
            width: 100%;
            height: 120px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 10px;
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-preview {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .btn-submit {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            color: white;
        }

        .btn-back {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            border: none;
            color: white;
            padding: 10px 25px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            margin-right: 15px;
        }

        .btn-back:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
            color: white;
            text-decoration: none;
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .success-message {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .file-info {
            margin-top: 5px;
            font-size: 11px;
            color: #6c757d;
            line-height: 1.2;
        }

        .sub-images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="card">
            <div class="card-header">
                <h1 class="h3 mb-0">
                    <i class="bi bi-images me-2"></i>
                    Cập nhật hình ảnh sản phẩm
                </h1>
                <p class="mb-0 mt-2 opacity-75" th:text="'Sản phẩm: ' + ${product.name}"></p>
            </div>
        </div>

        <!-- Error/Success Messages -->
        <div th:if="${error}" class="error-message">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <span th:text="${error}"></span>
        </div>

        <div th:if="${msg}" class="success-message">
            <i class="bi bi-check-circle-fill me-2"></i>
            <span th:text="${msg}"></span>
        </div>

        <!-- Current Images Display -->
        <div class="card current-images">
            <div class="card-body">
                <h4 class="card-title mb-4">
                    <i class="bi bi-collection me-2"></i>
                    Hình ảnh hiện tại
                </h4>
                
                <div class="row">
                    <!-- Main Image -->
                    <div class="col-md-6">
                        <h5 class="text-muted mb-3">Hình ảnh chính</h5>
                        <div th:if="${product.main_image_url}" class="image-container">
                            <img th:src="${product.main_image_url}" alt="Hình ảnh chính" />
                            <div class="image-label main-image-label">
                                <i class="bi bi-star-fill me-1"></i>
                                Hình ảnh chính
                            </div>
                        </div>
                        <div th:unless="${product.main_image_url}" class="empty-state">
                            <i class="bi bi-image"></i>
                            <p>Chưa có hình ảnh chính</p>
                        </div>
                    </div>

                    <!-- Sub Images -->
                    <div class="col-md-6">
                        <h5 class="text-muted mb-3">Hình ảnh phụ</h5>
                        <div th:if="${product.sub_images != null and !product.sub_images.isEmpty()}" class="sub-images-grid">
                            <div th:each="subImage, iterStat : ${product.sub_images}" class="image-container">
                                <img th:src="${subImage.sub_image_url}" alt="Hình ảnh phụ" />
                                <div class="image-label">
                                    <i class="bi bi-images me-1"></i>
                                    Phụ <span th:text="${iterStat.index + 1}"></span>
                                </div>
                            </div>
                        </div>
                        <div th:if="${product.sub_images == null or product.sub_images.isEmpty()}" class="empty-state">
                            <i class="bi bi-images"></i>
                            <p>Chưa có hình ảnh phụ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Update Images Form -->
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-4">
                    <i class="bi bi-cloud-upload me-2"></i>
                    Cập nhật hình ảnh
                </h4>

                <form th:action="@{/seller/update-product-images}" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="productId" th:value="${product.id}" />

                    <!-- Image Upload Grid -->
                    <div class="row">
                        <!-- Main Image Upload -->
                        <div class="col-md-6 col-lg-3 mb-4">
                            <label class="form-label">
                                <i class="bi bi-star-fill me-2 text-warning"></i>
                                Hình ảnh chính
                            </label>
                            <div class="file-input-container">
                                <input type="file" id="mainImage" name="mainImage" class="file-input" accept="image/*" />
                                <label for="mainImage" class="file-label" id="mainImageLabel">
                                    <div>
                                        <i class="bi bi-cloud-upload me-2"></i>
                                        <br>Chọn hình ảnh chính
                                        <div class="file-info">JPG, PNG, GIF<br>Tối đa 5MB</div>
                                    </div>
                                </label>
                            </div>
                            <div id="mainImagePreview" class="preview-container"></div>
                        </div>

                        <!-- Sub Image 1 -->
                        <div class="col-md-6 col-lg-3 mb-4">
                            <label class="form-label">
                                <i class="bi bi-image me-2 text-info"></i>
                                Hình ảnh phụ 1
                            </label>
                            <div class="file-input-container">
                                <input type="file" id="subImage1" name="subImages" class="file-input" accept="image/*" />
                                <label for="subImage1" class="file-label" id="subImage1Label">
                                    <div>
                                        <i class="bi bi-cloud-upload me-2"></i>
                                        <br>Chọn hình ảnh phụ 1
                                        <div class="file-info">JPG, PNG, GIF<br>Tối đa 5MB</div>
                                    </div>
                                </label>
                            </div>
                            <div id="subImage1Preview" class="preview-container"></div>
                        </div>

                        <!-- Sub Image 2 -->
                        <div class="col-md-6 col-lg-3 mb-4">
                            <label class="form-label">
                                <i class="bi bi-image me-2 text-info"></i>
                                Hình ảnh phụ 2
                            </label>
                            <div class="file-input-container">
                                <input type="file" id="subImage2" name="subImages" class="file-input" accept="image/*" />
                                <label for="subImage2" class="file-label" id="subImage2Label">
                                    <div>
                                        <i class="bi bi-cloud-upload me-2"></i>
                                        <br>Chọn hình ảnh phụ 2
                                        <div class="file-info">JPG, PNG, GIF<br>Tối đa 5MB</div>
                                    </div>
                                </label>
                            </div>
                            <div id="subImage2Preview" class="preview-container"></div>
                        </div>

                        <!-- Sub Image 3 -->
                        <div class="col-md-6 col-lg-3 mb-4">
                            <label class="form-label">
                                <i class="bi bi-image me-2 text-info"></i>
                                Hình ảnh phụ 3
                            </label>
                            <div class="file-input-container">
                                <input type="file" id="subImage3" name="subImages" class="file-input" accept="image/*" />
                                <label for="subImage3" class="file-label" id="subImage3Label">
                                    <div>
                                        <i class="bi bi-cloud-upload me-2"></i>
                                        <br>Chọn hình ảnh phụ 3
                                        <div class="file-info">JPG, PNG, GIF<br>Tối đa 5MB</div>
                                    </div>
                                </label>
                            </div>
                            <div id="subImage3Preview" class="preview-container"></div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-between align-items-center mt-4">
                        <a th:href="@{/seller/product/product-detail/{id}(id=${product.id})}" class="btn-back">
                            <i class="bi bi-arrow-left me-2"></i>
                            Quay lại
                        </a>
                        
                        <button type="submit" class="btn-submit">
                            <i class="bi bi-check-circle me-2"></i>
                            Gửi yêu cầu cập nhật hình ảnh
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Array of image input configurations
            const imageInputs = [
                {
                    inputId: 'mainImage',
                    labelId: 'mainImageLabel',
                    previewId: 'mainImagePreview',
                    defaultText: 'Chọn hình ảnh chính',
                    fileInfo: 'JPG, PNG, GIF<br>Tối đa 5MB'
                },
                {
                    inputId: 'subImage1',
                    labelId: 'subImage1Label',
                    previewId: 'subImage1Preview',
                    defaultText: 'Chọn hình ảnh phụ 1',
                    fileInfo: 'JPG, PNG, GIF<br>Tối đa 5MB'
                },
                {
                    inputId: 'subImage2',
                    labelId: 'subImage2Label',
                    previewId: 'subImage2Preview',
                    defaultText: 'Chọn hình ảnh phụ 2',
                    fileInfo: 'JPG, PNG, GIF<br>Tối đa 5MB'
                },
                {
                    inputId: 'subImage3',
                    labelId: 'subImage3Label',
                    previewId: 'subImage3Preview',
                    defaultText: 'Chọn hình ảnh phụ 3',
                    fileInfo: 'JPG, PNG, GIF<br>Tối đa 5MB'
                }
            ];

            // Initialize each image input
            imageInputs.forEach(config => {
                const input = document.getElementById(config.inputId);
                const label = document.getElementById(config.labelId);
                const preview = document.getElementById(config.previewId);

                input.addEventListener('change', function(e) {
                    handleSingleFilePreview(e.target, label, preview, config);
                });
            });

            function handleSingleFilePreview(input, label, previewContainer, config) {
                const file = input.files[0];
                previewContainer.innerHTML = '';

                if (file) {
                    // Check file size (5MB limit)
                    if (file.size > 5 * 1024 * 1024) {
                        alert(`Tệp ${file.name} vượt quá kích thước tối đa 5MB`);
                        input.value = '';
                        resetLabel(label, config);
                        return;
                    }

                    // Check file type
                    if (!file.type.startsWith('image/')) {
                        alert(`Tệp ${file.name} không phải là hình ảnh`);
                        input.value = '';
                        resetLabel(label, config);
                        return;
                    }

                    label.classList.add('has-file');

                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="Preview" />
                            <button type="button" class="remove-preview" onclick="removePreview('${config.inputId}')">
                                <i class="bi bi-x"></i>
                            </button>
                        `;
                        previewContainer.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);

                    label.innerHTML = `
                        <div>
                            <i class="bi bi-check-circle me-2"></i>
                            <br>${file.name}
                            <div class="file-info">Nhấn để chọn hình ảnh khác</div>
                        </div>
                    `;
                } else {
                    resetLabel(label, config);
                }
            }

            function resetLabel(label, config) {
                label.classList.remove('has-file');
                label.innerHTML = `
                    <div>
                        <i class="bi bi-cloud-upload me-2"></i>
                        <br>${config.defaultText}
                        <div class="file-info">${config.fileInfo}</div>
                    </div>
                `;
            }

            // Global function for remove preview
            window.removePreview = function(inputId) {
                const input = document.getElementById(inputId);
                const config = imageInputs.find(c => c.inputId === inputId);
                const label = document.getElementById(config.labelId);
                const previewContainer = document.getElementById(config.previewId);
                
                input.value = '';
                previewContainer.innerHTML = '';
                resetLabel(label, config);
            };
        });
    </script>
</body>

</html>